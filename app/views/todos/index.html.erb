<%= render "partial/dashboard", layout: 'box', user: @user do %>
  <nav class="flex">
    <%= link_to image_tag("plus.svg", border: 0), { action: 'new', controller: "todos"}, class: 'py-2 px-4 bg-blue-500 text-white mr-2 rounded-md cursor-pointer' %>

    <%= link_to 'Hide done', { action: 'hide', controller: "todos"}, class: 'py-2 px-4 bg-blue-500 text-white mr-2 rounded-md cursor-pointer' %>
  </nav>

  <ul role="list" class="divide-y divide-gray-100 mt-4">
    <% @todos.each do |todo| %>
      <li class="flex justify-between gap-x-6 py-5 cursor-pointer">
        <div class="flex min-w-0 gap-x-4" onclick="changeState('<%= todo.id %>')">
          <%= check_box_tag todo.id, todo.id, todo.done %>
          <%= todo.title %>
        </div>
        <div class="grow-1 flex">
          <%= link_to "Edit", {controller: "todos", action: "edit", id: todo.id}, class: 'py-2 px-4 bg-blue-500 text-white inline rounded-md cursor-pointer mr-2' %>
          <%= button_to "Delete", {controller: "todos", action: "destroy", id: todo.id}, method: :delete, form: { data: { turbo_confirm: "Are you sure"}}, class: 'py-2 px-4 bg-red-500 text-white inline rounded-md cursor-pointer' %>
        </div>
      </li>
    <% end %>
  </ul>

  <script>
    changeState = (id) => {
      const parentElement = document.getElementById(id)

      if (parentElement.checked) {
        parentElement.checked = false
      } else {
        parentElement.checked = true
      }

      const path = parentElement.checked ? `/check/${id}.json` : `/uncheck/${id}.json`

      fetch(path,
        { 
          method: 'POST',
          headers: {
            "Content-Type": "application/json",
            "X-CSRF-Token": document.querySelector("meta[name='csrf-token']").content,
          },
        }
      )
    }
  </script>
<% end %>