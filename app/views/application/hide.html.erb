<h1 class="text-3xl block mb-4">Welcome to the Ruby on Rails todo app</h1>

<%= link_to('Add new', { action: 'new', controller: "application"}, class: 'py-2 px-4 bg-blue-500 text-white') %>

<%= link_to('Show all', { action: 'index', controller: "application"}, class: 'py-2 px-4 bg-blue-500 text-white') %>

<ul class="mt-4">
  <% @todos.each do |todo| %>
    <li class="my-2">
      <%= todo.title %> - 
      <%= todo.updated_at %> - 
      <%= check_box_tag(todo.id, todo.id, todo.done, :onclick => "changeState(event)") %>
    </li>
  <% end %>
</ul>

<script>
  const changeState = (event) => {

    const id = event.target.value
    const checked = event.target.checked

    const path = checked ? `/check/${id}.json` : `/uncheck/${id}.json`

    fetch(path,
      { 
        method: 'POST',
        headers: {
          "Content-Type": "application/json",
          "X-CSRF-Token": document.querySelector("meta[name='csrf-token']").content,
        },
      }
    )
  }
</script>