<%= render "partial/dashboard", layout: 'box', user: @user do %>
<nav class="flex">
<%= link_to 'Add new', { action: 'new', controller: "application"}, class: 'py-2 px-4 bg-blue-500 text-white mr-2 rounded-md cursor-pointer' %>

<%= link_to 'Hide done', { action: 'hide', controller: "application"}, class: 'py-2 px-4 bg-blue-500 text-white mr-2 rounded-md cursor-pointer' %>
</nav>

<ul role="list" class="divide-y divide-gray-100 mt-4">
  <% @todos.each do |todo| %>
  <li class="flex justify-between gap-x-6 py-5">
    <div class="flex min-w-0 gap-x-4">
      <%= check_box_tag(todo.id, todo.id, todo.done, :onclick => "changeState(event)") %>
      <%= todo.title %>
      <% if todo.due_date %>
      <%= todo.due_date.strftime('%d/%m/%Y %H:%M') %>
      <% end %>
    </div>
    <div class="hidden shrink-0 sm:flex sm:flex-col sm:items-end">
      <%= button_to "Delete", {controller: "application", action: "delete", id: todo.id}, method: :delete, form: { data: { turbo_confirm: "Are you sure"}}, class: 'py-2 px-4 bg-red-500 text-white inline rounded-md cursor-pointer' %>
    </div>
  </li>
<% end %>
</ul>

<script>
  changeState = (event) => {
    const { value, checked } = event.target

    const path = checked ? `/check/${value}.json` : `/uncheck/${value}.json`

    fetch(path,
      { 
        method: 'POST',
        headers: {
          "Content-Type": "application/json",
          "X-CSRF-Token": document.querySelector("meta[name='csrf-token']").content,
        },
      }
    )
  }
</script>
<% end %>